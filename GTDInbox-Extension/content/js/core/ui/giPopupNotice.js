var giPopupNotice=giUIObject.extend({_eventsContainer:null,el:null,_elContainer:null,_elContent:null,id:null,connect:function(main){giLogger.log("st","giPopupNotice.connect",main?main.pageId:giLogger.UNKNOWN_PAGE_ID);this.base(main);this._eventsContainer=new giEventsContainer(this)},_load:function(fileName){try{var doc=this._main.gmail.canvasDocument;this.el=doc.createElement("DIV");this.el.className="gtdi gtdi-popup gtdi-popup-notice gtdi-popup-notice-"+this.id;this.el.style.position="absolute";
this._elContainer=doc.createElement("DIV");this._elContainer.id="gtdi-browser-container";this.el.appendChild(this._elContainer);var elClose=doc.createElement("A");elClose.className="gtdi-close";elClose.title=giI18N.getString("Browser.Popup.Close");elClose.innerHTML=giI18N.getString("Browser.Popup.Close");this._elContainer.appendChild(elClose);this._elContent=doc.createElement("DIV");this._elContent.className="gtdi-popup-notice-content gtdi-popup-notice-content-"+this.id;this._elContainer.appendChild(this._elContent);
this._main.gmail.canvasDocument.body.appendChild(this.el);this._eventsContainer.observe(this._elContainer,"click",this._click,false);this._main.gmail.lightbox.show();this._eventsContainer.observe(this._main.gmail.canvasDocument,"keydown",this._keyDown,false);if(fileName){giLogger.log("load "+fileName+" from url","giPopupNotice.load",this._main?this._main.pageId:giLogger.UNKNOWN_PAGE_ID);var me=this;giFileIO.readFile(null,fileName,null,function(fileText){me._load_postReadContent(fileText)})}}catch(e){try{if(this._main.gmail.lightbox)this._main.gmail.lightbox.hide();
if(this.el&&this.el.parentNode)this.el.parentNode.removeChild(this.el)}catch(e){}giLogger.warn(e,"giPopupNotice.load",null,this._main?this._main.pageId:giLogger.UNKNOWN_PAGE_ID)}},_load_postReadContent:function(fileText){try{var doc=this._main.gmail.canvasDocument;this._elContent.innerHTML=fileText;var result=doc.evaluate(".//*[@geturl]",this.el,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var i=0;i<result.snapshotLength;i++){var el=result.snapshotItem(i);if(el.src)el.src=giUrl.getURL(el.getAttribute("src"))}this._centerPopup();
this.dispatchEvent({name:giPopupNotice.CONTENT_LOADED})}catch(e){giLogger.warn(e,"giPopupNotice._load_postReadContent",null,this._main?this._main.pageId:giLogger.UNKNOWN_PAGE_ID)}},_centerPopup:function(){try{var popupDims=giUIObject.getDimensions(this.el);var viewport=giUIObject.viewport(this.el.ownerDocument);x=viewport[0]/2-popupDims.width/2;y=viewport[1]/2-popupDims.height/2+this.el.ownerDocument.defaultView.pageYOffset;var xy=giUIObject.boundsCheckXY(this._elContainer,x,y,true,true);x=xy[0];
y=xy[1];this.el.style.left=x+"px";this.el.style.top=y+"px"}catch(e){giLogger.warn(e,"giPopupNotice._centerPopup",null,this._main?this._main.pageId:giLogger.UNKNOWN_PAGE_ID)}},disconnect:function(){this._eventsContainer.stopObserving(this._main.gmail.canvasDocument,"keydown",this._keyDown,false);this._main.gmail.lightbox.hide();if(this.el&&this.el.parentNode)this.el.parentNode.removeChild(this.el);this.el=null;for(p in this)if(this[p]&&this[p].nodeName&&this[p].nodeType)this[p]=null;this._eventsContainer.reset();
this._eventsContainer=null;this.base()},_click:function(evt){try{var el=evt.target;if(el.className=="gtdi-close")this.disconnect()}catch(e){giLogger.warn(e,"giPopupNotice._click",null,this._main?this._main.pageId:giLogger.UNKNOWN_PAGE_ID)}},_keyDown:function(evt){if(evt.keyCode==27)this.disconnect()}},{CONTENT_LOADED:"content_loaded"});giPopupNotice.implement(giEventDispatcher);
