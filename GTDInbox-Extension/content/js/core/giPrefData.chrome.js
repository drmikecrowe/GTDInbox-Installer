var giPrefData=giBase.extend({prefs:null,defaults:null,pluginVersions:null,_port:null,_timer:null,_changed:false,_loaded:false,constructor:function(){this._port=chrome.extension.connect({name:"prefData"});var me=this;this._port.onMessage.addListener(function(msg){me._onMessage(msg)});this._load()},_onMessage:function(msg){if(msg.clientAction)switch(msg.clientAction){case "load":try{this.prefs=msg.prefs;this.defaults=msg.defaults;this.pluginVersions=msg.pluginVersions;if(!this._loaded){this._loaded=
true;this.dispatchEvent({name:giPrefData.LOADED})}}catch(e){giLogger.warn(e,"giPrefData._onMessage",giLogger.dump(msg))}break}},_load:function(){this._port.postMessage({bgAction:"load"})},save:function(){this._changed=false;if(this._timer){clearTimeout(this._timer);this._timer=null}this._port.postMessage({bgAction:"save",prefs:this.prefs,defaults:this.defaults,pluginVersions:this.pluginVersions})},requestSave:function(){this._changed=true;var me=this;if(this._timer)clearTimeout(this._timer);this._timer=
setTimeout(function(){me.save()},1*1E3)}},{LOADED:"loaded"});giPrefData.implement(giEventDispatcher);
