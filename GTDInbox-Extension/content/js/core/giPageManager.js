var giPageManager=giBase.extend(null,{loadPage:function(doc,browserName){try{if(doc._gtdiLoadPage)return;var url=doc&&doc.defaultView&&doc.defaultView.location?doc.defaultView.location.href:"not-found";giLogger.log("try .loadPage with url: "+url,"giPageManager.loadPage");if(url.indexOf("view=bsp")>-1){var elComms=doc.createElement("DIV");elComms.id="aig-doctest";doc.documentElement.appendChild(elComms);var elScript=doc.createElement("SCRIPT");elScript.setAttribute("type","text/javascript");var code=
"var desiredDoc = top.document.getElementById('canvas_frame').contentDocument;\n";code+="var elComms = document.getElementById('aig-doctest');\n";code+="if( document==desiredDoc ) elComms.setAttribute('result', '1');\n";code+="else elComms.setAttribute('result', '0');\n";elScript.innerHTML=code;doc.documentElement.appendChild(elScript);var result=elComms.getAttribute("result");elScript.parentNode.removeChild(elScript);elComms.parentNode.removeChild(elComms);if(result=="1"){giLogger.log(".loadPage success with url: "+
url,"giPageManager.loadPage");giPageManager._loadPage_testAccount(doc,browserName)}}}catch(e){giLogger.warn(e,"giPageManager.loadPage")}},_loadPage_testAccount:function(doc,browserName,attempts){try{if(!attempts)attempts=1;var envOk=false;var account=glPageWrapper.getGlobalStatic(doc,null,"account");if(account&&giUtil.testEmailAddress(account)){var elHead=doc.getElementsByTagName("HEAD")[0];var elBody=doc.getElementsByTagName("BODY")[0];if(elHead&&elBody)envOk=true}if(envOk)giPluginManager.loadPage(doc,
browserName,account);else if(attempts++<20)setTimeout(function(){giPageManager._loadPage_testAccount(doc,browserName,attempts)},500);else giPluginManager.loadPage(doc,browserName)}catch(e){giLogger.warn(e,"giPageManager._loadPage_testAccount")}}});
