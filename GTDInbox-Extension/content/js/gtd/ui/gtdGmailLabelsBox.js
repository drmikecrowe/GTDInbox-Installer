var gtdGmailLabelsBox=giUIObject.extend({elRecentTitle:null,elRecent:null,_eventsContainer:null,connect:function(main){giLogger.log("st","gtdGmailLabelsBox.connect",main?main.pageId:giLogger.UNKNOWN_PAGE_ID);this.base(main);this._eventsContainer=new giEventsContainer(this);var doc=this._main.gmail.canvasDocument;var elFirstRecentItem=doc.evaluate(".//div[@class='n3']/div[@class='zw']//div[contains(@class, 'TK')]//a[contains(@href, '#label/')]",doc.body,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;
if(!elFirstRecentItem)elFirstRecentItem=doc.evaluate(".//div[@class='n3']/div[@class='zw']/table//a[contains(@href, '#label/')]",doc.body,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!elFirstRecentItem)elFirstRecentItem=doc.evaluate(".//div[@class='n3']/div[@class='zw']/div[@class='Mdjed']",doc.body,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(elFirstRecentItem)try{while(elFirstRecentItem.parentNode&&elFirstRecentItem.nodeName!="TABLE"&&elFirstRecentItem.className.indexOf("Mdjed")==
-1&&elFirstRecentItem.className.indexOf("TK")==-1)elFirstRecentItem=elFirstRecentItem.parentNode;this.elRecent=elFirstRecentItem;this.elRecentTitle=doc.createElement("DIV");this.elRecentTitle.id="gtdi-gmaillabelsbox-recent-title";this.elRecentTitle.className="n2";this.elRecentTitle.innerHTML="<IMG src=''/> "+giI18N.getString("GmailLabelsBox.Recent.Title");this.elRecentTitle.title=giI18N.getString("GmailLabelsBox.Recent.Title.tooltip");this.elRecent.parentNode.parentNode.insertBefore(this.elRecentTitle,
this.elRecent.parentNode);this._eventsContainer.observe(this.elRecentTitle,"mousedown",this._clickRecentTitle,false);this._eventsContainer.observe(this.elRecentTitle,"mouseover",this._mouseoverRecentTitle,false);this._recentHidden(this._main.prefs.getPref("components.navigation.gmail_labels_box.recent_hidden"))}catch(e){if(this.elRecentTitle&&this.elRecentTitle.parentNode)this.elRecentTitle.parentNode.removeChild(this.elRecentTitle);giLogger.logConcern("Gmail Recent Labels could not be inserted: "+
e,"gtdGmailLabelsBox.connect",this._main?this._main.pageId:giLogger.UNKNOWN_PAGE_ID)}else giLogger.logConcern("Gmail Recent Labels not found","gtdGmailLabelsBox.connect",this._main?this._main.pageId:giLogger.UNKNOWN_PAGE_ID)},disconnect:function(){if(this.elRecentTitle&&this.elRecentTitle.parentNode)this.elRecentTitle.parentNode.removeChild(this.elRecentTitle);this.elRecentTitle=null;this.elRecent=null;this._eventsContainer.reset();this._eventsContainer=null;this.base()},_clickRecentTitle:function(evt){try{this._recentHidden(!this._recentHidden())}catch(e){giLogger.warn(e,
"gtdGmailLabelsBox._clickRecentTitle",null,this._main?this._main.pageId:giLogger.UNKNOWN_PAGE_ID)}},_mouseoverRecentTitle:function(evt){try{if(this._recentHidden()){var doc=this._main.gmail.canvasDocument;var elMover=doc.evaluate("./div[@class='lE']",doc.body,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(elMover)this._recentHidden(false)}}catch(e){giLogger.warn(e,"gtdGmailLabelsBox._mouseoverRecentTitle",null,this._main?this._main.pageId:giLogger.UNKNOWN_PAGE_ID)}},_recentHidden:function(v){if(typeof v!=
"undefined"){this.elRecent.style.display=v?"none":"";if(v){giUIObject.addClassName(this.elRecentTitle,"gtdi-gmaillabelsbox-recent-hidden");this.elRecentTitle.getElementsByTagName("IMG")[0].src=giUrl.getURL("skin/gtd/group-closed.gif")}else{this.elRecentTitle.getElementsByTagName("IMG")[0].src=giUrl.getURL("skin/gtd/group-open.gif");giUIObject.removeClassName(this.elRecentTitle,"gtdi-gmaillabelsbox-recent-hidden")}this._main.prefs.setPref("components.navigation.gmail_labels_box.recent_hidden",v)}return this.elRecent.style.display==
"none"}});
