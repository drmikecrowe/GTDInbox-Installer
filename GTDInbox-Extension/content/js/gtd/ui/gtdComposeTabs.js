var gtdComposeTabs=giUIObject.extend({_eventsContainer:null,_elsHidden:null,el:null,elTabs:null,connect:function(main){giLogger.log("st","gtdComposeTabs.connect",main?main.pageId:giLogger.UNKNOWN_PAGE_ID);this.base(main);this._elsHidden=[];this._eventsContainer=new giEventsContainer(this);var doc=main.gmail.canvasDocument;this.elTabs=doc.createElement("DIV");this.elTabs.className="compose-tabs";this.elTabs.innerHTML="<div id='compose-tab-mail' class='compose-tab gtdi-active'>"+giI18N.getString("Compose.Mail")+
"</div><div id='compose-tab-personal' class='compose-tab'>"+giI18N.getString("Compose.Personal")+"</div>";this.el=doc.createElement("TR");var elTd=doc.createElement("TD");elTd.setAttribute("colspan","3");elTd.appendChild(this.elTabs);this.el.appendChild(elTd);var composeView=main.gmail.getCurrentViewObject();var elTBody=composeView.composeTable.getElementsByTagName("TBODY")[0];elTBody.insertBefore(this.el,elTBody.firstChild);this._eventsContainer.observe(this.el,"mousedown",this._click,false)},_click:function(event){try{var elTab=
event.target;this.select(elTab.id)}catch(e){giLogger.warn(e,"gtdComposeTabs._click",null,this._main?this._main.pageId:giLogger.UNKNOWN_PAGE_ID)}},select:function(id){var doc=this._main.gmail.canvasDocument;var elTab=doc.getElementById(id);if(!elTab)return;for(var i=0;i<this.elTabs.childNodes.length;i++){if(this.elTabs.childNodes[i].id==id&&giUIObject.hasClassName(this.elTabs.childNodes[i],"gtdi-active"))return;giUIObject.removeClassName(this.elTabs.childNodes[i],"gtdi-active")}for(var i=0;i<this._elsHidden.length;i++)this._elsHidden[i].style.display=
"";this._elsHidden.length=0;var composeView=this._main.gmail.getCurrentViewObject();switch(elTab.id){case "compose-tab-mail":composeView.toField.value=this._lastToFieldValue||"";break;case "compose-tab-personal":var elTable=composeView.composeTable;var elRows=elTable.getElementsByTagName("TR");this._lastToFieldValue=composeView.toField.value;var filterName=this._main.prefs.getPref("components.compose.compose_personal.filter_name");if(filterName)filterName="+"+filterName;composeView.toField.value=
this._main.gmail.environment.getAccount().replace("@",filterName+"@");var elSubject=null;for(var i=1;i<=6;i++){var elTrInput=elRows[i].getElementsByTagName("INPUT")[0];if(elTrInput&&elTrInput.getAttribute("name")=="subject"){elSubject=elTrInput;break}if(elRows[i].style.display!="none"){this._elsHidden.push(elRows[i]);elRows[i].style.display="none"}}if(elSubject){giUIObject.simulateMouseEvent(elSubject,"click",-1,-1);elSubject.focus();setTimeout(function(){giUIObject.simulateMouseEvent(elSubject,"click",
-1,-1);elSubject.focus()},400)}break}giUIObject.addClassName(elTab,"gtdi-active")},disconnect:function(){if(this.el&&this.el.parentNode)this.el.parentNode.removeChild(this.el);this.el=null;this.elTabs=null;this._eventsContainer.reset();for(var i=0;i<this._elsHidden.length;i++)this._elsHidden[i].style.display="";this._elsHidden.length=0;this.base()}});
