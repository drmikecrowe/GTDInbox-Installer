var glDropdown=giUIObject.extend({elButton:null,elButtonTitle:null,elContent:null,_eventsContainer:null,connect:function(gmail){giLogger.log("st","glDropdown.connect",gmail.pageId);this.base(gmail);this._eventsContainer=new giEventsContainer(this)},disconnect:function(){this._removeAllListeners();this.hideDropdown();this._eventsContainer.reset();this._eventsContainer=null;if(this.elButton.parentNode)this.elButton.parentNode.removeChild(this.elButton);this.elButton=null;this.elContent=null;this.base()},
init:function(elButton,elButtonTitle,elContent){var doc=this._main.canvasDocument;if(!elButton){elButton=doc.createElement("DIV");elButton.className="gtdi-btn";elButton.innerHTML="<b class='gtdi-btn-t'></b><b class='gtdi-btn-t2'></b><b class='gtdi-btn-m'></b><b class='gtdi-btn-b2'></b><b class='gtdi-btn-b'></b><span class='gtdi-btn-label'></span>";if(!elButtonTitle)elButtonTitle=elButton.getElementsByTagName("SPAN")[0]}this.elButton=elButton;giUIObject.addClassName(this.elButton,"gtdi-dropdown");
this.elButtonTitle=elButtonTitle;if(!this.elButtonTitle)giLogger.error("No elButtonTitle","glDropdown.init",this._main?this._main.pageId:giLogger.UNKNOWN_PAGE_ID);if(!elContent)elContent=doc.createElement("DIV");this.elContent=elContent;giUIObject.addClassName(this.elContent,"gtdi-dropdown-content");this.elContent.style.display="none";this.elButton.appendChild(this.elContent);this._eventsContainer.observe(this.elButton,"click",this._click,false)},_showDropdown:function(){this._eventsContainer.observe(this.elButton.ownerDocument.body,
"mousedown",this._mousedownWindow,true);this.elContent.style.display="";giUIObject.addClassName(this.elButton,"gtdi-active");this.dispatchEvent({name:glDropdown.SHOW_DROPDOWN})},hideDropdown:function(){giUIObject.removeClassName(this.elButton,"gtdi-active");this._eventsContainer.stopObserving(this.elButton.ownerDocument.body,"mousedown",this._mousedownWindow,true);this.elContent.style.display="none";this.dispatchEvent({name:glDropdown.HIDE_DROPDOWN})},_click:function(event){try{var el=event.target;
var i=6;while(el.parentNode&&--i>=0){if(giUIObject.hasClassName(el,"gtdi-dropdown")&&this.elContent.style.display=="none"){this._showDropdown();return}if(giUIObject.hasClassName(el,"gtdi-dropdown-content"))return;el=el.parentNode}}catch(e){giLogger.warn(e,"glDropdown._click",null,this._main?this._main.pageId:giLogger.UNKNOWN_PAGE_ID)}},_mousedownWindow:function(event){if(event.clientX==50&&event.clientY==50)return;try{var found=false;var el=event.target;var i=5;while(el.parentNode&&--i>=0){if(el==
this.elContent){found=true;break}el=el.parentNode}if(!found)this.hideDropdown()}catch(e){giLogger.warn(e,"glDropdown._mousedownWindow",null,this._main?this._main.pageId:giLogger.UNKNOWN_PAGE_ID)}}},{SHOW_DROPDOWN:"show_dropdown",HIDE_DROPDOWN:"hide_dropdown"});glDropdown.implement(giEventDispatcher);
