var glActionsHeader=glUIWidget.extend({root:null,pagination:null,moveToDropdownButton:null,_moveToDropdownMenu:null,labelsDropdownButton:null,_labelsDropdownMenu:null,moreActionsDropdownButton:null,_moreActionsDropdownMenu:null,_elContainer:null,_viewType:null,connect:function(gmail){giLogger.log("st","glActionsHeader.connect",gmail.pageId);this.base(gmail);this._viewType=gmail.page.getActiveViewType()},getValidRoot:function(elContainer,viewRoot){if(!elContainer){if(!viewRoot)viewRoot=this._gmail.page.getViewRoot();
elContainer=viewRoot}if(this._viewType=="tl")var results=this._gmail.canvasDocument.evaluate('.//div[contains(@class,"A1 D")]/div[@class="nH"][1]',elContainer,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);else var results=this._gmail.canvasDocument.evaluate('.//div[@class="nH"]/div[contains(@class, "iI D")]',elContainer,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);return giUIObject.shallowestSnapshotItem(results,elContainer)},load:function(elContainer){var viewRoot=this._gmail.page.getViewRoot();
if(!viewRoot)giLogger.error("Could not find view root","glActionsHeader.load",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);var doc=this._gmail.canvasDocument;this._elContainer=elContainer;this.root=this.getValidRoot(elContainer,viewRoot);if(!this.root){var url=this._gmail&&this._gmail.page?this._gmail.page.location("href"):"not-found";var additionalErrorInfo="";try{var vrClone=viewRoot.cloneNode(true);var tables=vrClone.getElementsByTagName("TABLE");for(var i=0;i<tables.length;i++)if(tables[i].className.indexOf("cf")==
-1)tables[i].parentNode.removeChild(tables[i]);giLogger.logHTML(vrClone.innerHTML,"this.root error in glActionsHeader.load (HTML for viewRoot minus tables) for url: "+url,"",true,this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID)}catch(e){additionalErrorInfo="Error in vrClone process: "+e}giLogger.error("Could not find the actions header root node (this.root) for view of "+this._viewType+" for url: "+url+". "+additionalErrorInfo,"glActionsHeader.load",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID)}this.pagination=
this.root.childNodes[1];var result=doc.evaluate(".//div[@class='Pl J-J5-Ji']/div[contains(@class, 'L3')][1]",this.root,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);if(!result.singleNodeValue)result=doc.evaluate(".//div[starts-with(@class,'eeCDlc')][2]/div[1]",this.root,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);if(!result.singleNodeValue)result=doc.evaluate(".//div[starts-with(@class,'eeCDlc')][2]/div[starts-with(@class,'goog-imageless-button')][1]",this.root,null,XPathResult.FIRST_ORDERED_NODE_TYPE,
null);if(!result.singleNodeValue)result=doc.evaluate(".//div[@class='sGcZQb']//div[starts-with(@class,'eeCDlc')][2]/div[starts-with(@class,'goog-imageless-button')][1] | .//div[@class='Wtoymb']//div[starts-with(@class,'eeCDlc')][2]/div[starts-with(@class,'goog-imageless-button')][1]",this.root,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);this.moveToDropdownButton=result.singleNodeValue;if(!this.moveToDropdownButton)new Error("Could not find moveTo dropdown button node [glActionsHeader.load]");var result=
doc.evaluate(".//div[@class='Pl J-J5-Ji']/div[contains(@class, 'L3')][2]",this.root,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);if(!result.singleNodeValue)result=doc.evaluate(".//div[starts-with(@class,'eeCDlc')][2]/div[2]",this.root,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);if(!result.singleNodeValue)result=doc.evaluate(".//div[starts-with(@class,'eeCDlc')][2]/div[starts-with(@class,'goog-imageless-button')][2]",this.root,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);if(!result.singleNodeValue)result=
doc.evaluate(".//div[@class='sGcZQb']//div[starts-with(@class,'eeCDlc')][2]/div[starts-with(@class,'goog-imageless-button')][2] | .//div[@class='Wtoymb']//div[starts-with(@class,'eeCDlc')][2]/div[starts-with(@class,'goog-imageless-button')][2]",this.root,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);this.labelsDropdownButton=result.singleNodeValue;if(!this.labelsDropdownButton)new Error("Could not find labels dropdown button node [glActionsHeader.load]");var result=doc.evaluate(".//div[@class='Pl J-J5-Ji'][3]/div[contains(@class, 'L3')][1]",
this.root,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);if(!result.singleNodeValue)result=doc.evaluate(".//div[starts-with(@class,'eeCDlc')][3]/div[1]",this.root,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);if(!result.singleNodeValue)result=doc.evaluate(".//div[starts-with(@class,'eeCDlc')][3]/div[starts-with(@class,'goog-imageless-button')][1]",this.root,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);if(!result.singleNodeValue)result=doc.evaluate(".//div[@class='sGcZQb']//div[starts-with(@class,'eeCDlc')][3]/div[starts-with(@class,'goog-imageless-button')][1] | .//div[@class='Wtoymb']//div[starts-with(@class,'eeCDlc')][3]/div[starts-with(@class,'goog-imageless-button')][1]",
this.root,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);if(!result.singleNodeValue)result=doc.evaluate(".//div[@class='QOD9Ec']",this.root,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);this.moreActionsDropdownButton=result.singleNodeValue;if(!this.moreActionsDropdownButton)new Error("Could not find moreActions dropdown button node [glActionsHeader.load]")},disconnect:function(){this.root=null;this.base()},isCacheable:function(){return false},hasButton:function(buttonCode){var result=this.root.ownerDocument.evaluate(".//div[@act='"+
buttonCode+"']",this.root,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return!!result.singleNodeValue},getButton:function(buttonCode){var result=this.root.ownerDocument.evaluate(".//div[@act='"+buttonCode+"']",this.root,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);if(!result.singleNodeValue)giLogger.warn("Could not find button: "+buttonCode,"glActionsHeader.getButton",null,this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);return result.singleNodeValue},clickDropdownMenuAction:function(dropdown,
buttonCode){var elMenu=this._getDropdownMenu(dropdown,true);var elAction=this._gmail.canvasDocument.evaluate(".//*[@act='"+buttonCode+"']",elMenu,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!elAction)giLogger.error("Could not find button element for "+dropdown+" with buttonCode "+buttonCode,"glActionsHeader.clickDropdownMenuAction",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);if(elAction.style.display!="none")this._gmail.page.simulateMouseEvent(elAction,["mousedown",
"mouseup"])},_getDropdownMenuLabels:function(dropdown,leaveOpen){var elDropdownMenu=this._getDropdownMenu(dropdown,leaveOpen);var elDropdownMenuLabels=this._gmail.canvasDocument.evaluate(".//div[starts-with(@class,'J-M-Jz')]",elDropdownMenu,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!elDropdownMenuLabels)elDropdownMenuLabels=this._gmail.canvasDocument.evaluate(".//td//div[starts-with(@class,'J-M-Jz')]",elDropdownMenu,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;
if(!elDropdownMenuLabels)elDropdownMenuLabels=this._gmail.canvasDocument.evaluate(".//td//div[starts-with(@class,'goog-menu-content')]",elDropdownMenu,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!elDropdownMenuLabels)giLogger.error("Could not find the label container element for "+dropdown,"glActionsHeader._getDropdownMenuLabels",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);return elDropdownMenuLabels},bulkLabel:function(fLabelTest){giLogger.log("st","glActionsHeader.bulkLabel",
this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);var fGetState=function(el){if(giUIObject.hasClassName(el,"J-LC-Ky-Jp"))return 1;else if(giUIObject.hasClassName(el,"J-LC-JR-Jp"))return 2;else if(giUIObject.hasClassName(el,"J-LC"))return 0;else giLogger.error("Could not detect state for elLabel: "+label,"glActionsHeader.bulkLabel [fGetState]",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID)};var elLabels=this._getDropdownMenuLabels(glActionsHeader.LABELS_DROPDOWN,true);var changedState=
false;for(var i=0;i<elLabels.childNodes.length;i++){var elLabel=elLabels.childNodes[i];var label=giUtil.decodeEntities(giUtil.stripTags(elLabel.innerHTML));var state=fGetState(elLabel);var newState=fLabelTest(label,state);if(newState>=0&&newState!=state){var limit=5;while(--limit>=0&&newState!=fGetState(elLabel)){var elCheckbox=elLabel.ownerDocument.evaluate(".//div[contains(@class, 'J-LC-Jo')]",elLabel,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!elCheckbox)giLogger.error("Could not find checkbox for elLabel: "+
label,"glActionsHeader.bulkLabel",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);this._gmail.page.simulateMouseEvent(elCheckbox,["mousedown","mouseup"])}if(limit<=0)giLogger.error("Could not set the label checkbox state (initially "+state+") to "+newState,"glActionsHeader.bulkLabel",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);if(!changedState)changedState=true}}if(changedState){var elDropdownMenu=this._getDropdownMenu(glActionsHeader.LABELS_DROPDOWN,true);var elApply=elDropdownMenu.ownerDocument.evaluate(".//div[contains(@class,'J-JK')]/div[@class='J-JK-Jz']",
elDropdownMenu,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!elApply)giLogger.error("Could not find elApply for "+label,"glActionsHeader.bulkLabel",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);this._gmail.page.simulateMouseEvent(elApply,["mousedown","mouseup"],null,null,true)}else this._closeDropdownMenu(glActionsHeader.LABELS_DROPDOWN)},_getDropdownMenuLabel:function(dropdown,label,leaveMenuOpen,inhibitError){if(dropdown!=glActionsHeader.LABELS_DROPDOWN&&dropdown!=
glActionsHeader.MOVE_TO_DROPDOWN)giLogger.error("This is only for the Labels Dropdown or the Move To Dropdown","glActionsHeader._getDropdownMenuLabel",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);var elLabels=this._getDropdownMenuLabels(dropdown,leaveMenuOpen);label=label.toLowerCase();var elLabel=null;for(var i=0;i<elLabels.childNodes.length;i++)if(giUtil.decodeEntities(giUtil.stripTags(elLabels.childNodes[i].innerHTML)).toLowerCase()==label){elLabel=elLabels.childNodes[i];break}if(!elLabel&&
!inhibitError)giLogger.error("Could not find label '"+label+"' for "+dropdown,"glActionsHeader._getDropdownMenuLabel",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);return elLabel},setLabelsDropdownLabelState:function(label,on,createIfNotFound){giLogger.log("Label: "+label+", on: "+on+", createIfNotFound: "+createIfNotFound,"glActionsHeader.setLabelsDropdownLabelState",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);var elLabel=this._getDropdownMenuLabel(glActionsHeader.LABELS_DROPDOWN,
label,true,createIfNotFound);if(elLabel){giLogger.log("Label ("+label+") found, update it to "+on,"glActionsHeader.setLabelsDropdownLabelState",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);var isOn=giUIObject.hasClassName(elLabel,"J-Ks-KO");if(isOn!=on)this._gmail.page.simulateMouseEvent(elLabel,["mousedown","mouseup"],null,null,true);else this._closeDropdownMenu(glActionsHeader.LABELS_DROPDOWN)}else{giLogger.log("Label ("+label+") not found, create it","glActionsHeader.setLabelsDropdownLabelState",
this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);this.createLabelWithDropdown(label)}},checkDropdownHasLabel:function(label){var elLabel=this._getDropdownMenuLabel(glActionsHeader.LABELS_DROPDOWN,label,false,true);return!!elLabel},createLabelWithDropdown:function(label){this._closeDropdownMenu(glActionsHeader.LABELS_DROPDOWN);var elDropdownMenu=this._getDropdownMenu(glActionsHeader.LABELS_DROPDOWN,true);var doc=this._gmail.canvasDocument;var elInput=doc.evaluate(".//div[@class='J-M-JJ']/input",
elDropdownMenu,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!elInput)giLogger.error("Could not find elInput while creating "+label,"glActionsHeader.createLabelWithDropdown",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);elInput.value=label;var elCreate=doc.evaluate(".//*[@act='14']",elDropdownMenu,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!elCreate)giLogger.error("Could not find elCreate while creating "+label,"glActionsHeader.createLabelWithDropdown",
this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);this._gmail.page.simulateMouseEvent(elCreate,["mousedown","mouseup"],null,null,true)},_closeDropdownMenu:function(dropdown){var elButton=this[dropdown+"Button"];if(!elButton)giLogger.error("Could not find button for "+dropdown,"glActionsHeader._closeDropdownMenu",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);if(this._isButtonOpen(elButton))this._gmail.page.simulateMouseEvent(elButton,["mousedown","mouseup"])},_isButtonOpen:function(elButton){return elButton.getAttribute("aria-expanded")==
"true"||giUIObject.hasClassName(elButton,"J-C41vtd-I-Kq")},_getDropdownMenu:function(dropdown,leaveOpen){if(this["_"+dropdown+"Menu"]){var button=this[dropdown+"Button"];if(!button)giLogger.error("Could not find button for "+dropdown,"glActionsHeader._getDropdownMenu",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);if(!this._isButtonOpen(button)){this._gmail.page.simulateMouseEvent(button,["mousedown","mouseup"],null,null,true);if(!leaveOpen)this._gmail.page.simulateMouseEvent(button,["mousedown",
"mouseup"],null,null,true)}}else{var button=this[dropdown+"Button"];if(!button)giLogger.error("Could not find button for "+dropdown,"glActionsHeader._getDropdownMenu",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);var hideAgain=false;if(!this._isButtonOpen(button)){hideAgain=true;this._gmail.page.simulateMouseEvent(button,["mousedown","mouseup"],null,null,true)}var doc=button.ownerDocument;var results=doc.evaluate(".//div[contains(@class,'J-M AW') or contains(@class,'J-M AR')]",this.root,
null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);if(results.snapshotLength==0)results=doc.evaluate(".//div[contains(@class,'goog-menu AW')]",this.root,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);var elem=null;var dropdownMenu=null;for(var i=0;i<results.snapshotLength;i++){var elem=results.snapshotItem(i);if(elem.style.display!="none"&&elem.childNodes.length>0){dropdownMenu=elem;break}}if(hideAgain&&!leaveOpen)this._gmail.page.simulateMouseEvent(button,["mousedown","mouseup"],null,null,true);
if(!dropdownMenu)giLogger.error("Could not find dropdown menu node ["+dropdown+"]","glActionsHeader._getDropdownMenu",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);this["_"+dropdown+"Menu"]=dropdownMenu}return this["_"+dropdown+"Menu"]},getHeaderHTML:function(forceViewRoot,elContainer){var doc=this._gmail.canvasDocument;var elRoot=null;var type=null;if(!forceViewRoot&&!elContainer&&this.root){type="actionsHeader";var elRoot=this.root.parentNode}else if(!forceViewRoot&&!elContainer&&this._elContainer){type=
"container";var elRoot=this._elContainer}else if(!forceViewRoot&&elContainer){type="container";var elRoot=elContainer}else{type="viewRoot";var elRoot=doc.evaluate(".//*[contains(@class,'glViewRoot')]",doc.body,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}var elRootClone=elRoot.cloneNode(true);if(type!="actionsHeader"){var results=doc.evaluate(".//*[@act]",elRootClone,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);if(results.snapshotLength>0){var limit=results.snapshotLength;if(limit>
4)limit=4;var elShared=null;for(var i=0;i<limit;i++){var el=results.snapshotItem(i);while(el.parentNode&&el!=elRootClone){el.setAttribute("gtdi_"+i,"1");if(i==limit-1){var found=true;for(var j=0;j<limit;j++)if(!el.getAttribute("gtdi_"+j)){found=false;break}if(found){elShared=el;elShared.setAttribute("gtdi_shared","1");break}}el=el.parentNode}if(elShared)break}if(elShared){var elTree=elShared.parentNode;while(elTree.parentNode){for(var i=0;i<elTree.parentNode.childNodes.length;i++)if(elTree.parentNode.childNodes[i]!=
elTree)elTree.parentNode.removeChild(elTree.parentNode.childNodes[i]);if(elTree==elRootClone)break;else elTree=elTree.parentNode}}}else{var results2=doc.evaluate(".//div[@class='gs']",elRootClone,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var i=0;i<results2.snapshotLength;i++)results2.snapshotItem(i).parentNode.removeChild(results2.snapshotItem(i));var results2=doc.evaluate(".//div[@class='HprMsc']",elRootClone,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var i=0;i<results2.snapshotLength;i++)results2.snapshotItem(i).parentNode.removeChild(results2.snapshotItem(i));
var results2=doc.evaluate(".//div[@class='nH Cp']",elRootClone,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var i=0;i<results2.snapshotLength;i++)results2.snapshotItem(i).parentNode.removeChild(results2.snapshotItem(i))}}return"<div id='getHeaderHTML_type'>"+type+"</div>\n"+elRootClone.innerHTML}},{ARCHIVE_BUTTON:7,REPORT_SPAM_BUTTON:9,DELETE_BUTTON:10,MOVE_TO_INBOX_BUTTON:8,DISCARD_DRAFTS_BUTTON:16,DELETE_FOREVER_BUTTON:17,NOT_SPAM_BUTTON:18,REFRESH_BUTTON:20,MARK_AS_READ:1,MARK_AS_UNREAD:2,
ADD_STAR:3,REMOVE_STAR:4,ARCHIVE:5,NOT_SPAM:6,CREATE_EVENT:7,FILTER_MESSAGES_LIKE_THESE:8,MUTE:9,MOVE_TO_DRAFTS:10,CREATE_LABEL:14,BACK_TO_TL:19,MOVE_TO_DROPDOWN:"moveToDropdown",LABELS_DROPDOWN:"labelsDropdown",MORE_ACTIONS_DROPDOWN:"moreActionsDropdown"});
