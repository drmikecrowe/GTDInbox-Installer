var glComposeBox=glUIWidget.extend({_gmail:null,_container:null,_cacheType:null,connect:function(gmail){giLogger.log("st","glComposeBox.connect",gmail.pageId);this.base(gmail);this._gmail=gmail;this.setScope()},disconnect:function(){this._cacheType=null;this._container=null;this._gmail=null;this.base()},setScope:function(container){if(container)this._container=container;else this._container=this._gmail.page.getViewRoot();this._cacheType=null},getType:function(box){if(!this._cacheType){box=box||this.getComposeBox(this._container);
if(box.nodeName=="IFRAME")this._cacheType="rich";else this._cacheType="plain"}return this._cacheType},setText:function(text){var box=this.getComposeBox(this._container);var type=this.getType(box);if(type=="rich")box.contentDocument.body.innerHTML=text;else box.value=text},getText:function(){var box=this.getComposeBox(this._container);var type=this.getType(box);if(type=="rich")return box.contentDocument.body.innerHTML;else return box.value},getComposeBox:function(container){this._cacheType=null;var doc=
this._gmail.canvasDocument;var elRich=doc.evaluate(".//iframe[contains(@class, 'editable')]",this._container,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(elRich){var elVis=elRich;var vis=true;while(elVis.parentNode){if(elVis.style.display=="none"){vis=false;break}elVis=elVis.parentNode}if(vis)return doc.getElementById(elRich.id)}var elPlain=doc.evaluate(".//textarea[contains(@class, 'dV')]",this._container,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!elPlain)elPlain=
doc.evaluate(".//textarea[contains(@class, 'Ak')]",this._container,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;var elVis=elPlain;var vis=true;while(elVis.parentNode){if(elVis.style.display=="none"){vis=false;break}elVis=elVis.parentNode}if(vis)return elPlain;else giLogger.error("Cannot find compose box. It is possible that the rich iframe has not yet loaded.","glComposeBox.getComposeBox",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID)},isCacheable:function(){return false}});
