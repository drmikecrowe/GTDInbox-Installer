var glOffline=giBase.extend({_gmail:null,_eventsContainer:null,_isUnstable:false,_elIcon:null,constructor:function(gmail){this._gmail=gmail;giLogger.log("st","glOffline.constructor",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);this._eventsContainer=new giEventsContainer(this);this._testState();var elHeader=this._gmail.canvasDocument.getElementById("guser");if(elHeader)this._eventsContainer.observe(elHeader,"DOMAttrModified",this._headerChange,false);else giLogger.error("Could not find Offline header",
"glOffline.constructor",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID)},shutdown:function(){this._eventsContainer.reset();this._eventsContainer=null;this._elIcon=null;this._gmail=null;this._removeAllListeners()},isUnstable:function(){return this._isUnstable},_headerChange:function(evt){try{if(evt.target.nodeName=="IMG"&&evt.target.className.indexOf("bo")==0&&evt.target.className!=this._lastClassname){this._testState();this._lastClassname=evt.target.className}}catch(e){giLogger.warn(e,"glOffline._headerChange",
null,this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID)}},_getIconEl:function(){if(!this._elIcon){var doc=this._gmail.canvasDocument;var elImg=doc.evaluate("//span/span/img[starts-with(@class,'bo')]",doc.body,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!elImg)giLogger.log("Could not find Offline icon el","glOffline._getIconEl",this._gmail?this._gmail.pageId:giLogger.UNKNOWN_PAGE_ID);this._elIcon=elImg?elImg:null}return this._elIcon},_testState:function(){var elIcon=this._getIconEl();
var isUnstable=false;if(elIcon&&elIcon.className)if(/bo (bw|bx)/.test(elIcon.className))isUnstable=false;else isUnstable=true;else isUnstable=false;if(isUnstable!=this._isUnstable){this._isUnstable=isUnstable;if(isUnstable)this.dispatchEvent({name:glOffline.GO_UNSTABLE});else this.dispatchEvent({name:glOffline.GO_ONLINE})}}},{GO_ONLINE:"go_online",GO_UNSTABLE:"go_unstable"});glOffline.implement(giEventDispatcher);
