var boxErrorReporter=giPopupNotice.extend({connect:function(main){giLogger.log("st","boxErrorReporter.connect",main?main.pageId:giLogger.UNKNOWN_PAGE_ID);this.id="boxerrorreporter";this.base(main);this._eventsContainer=new giEventsContainer(this);try{var account=this._main.gmail.environment.getAccount();var doc=this._main.gmail.canvasDocument;this._load("boxErrorReporter.htm");var elUl=doc.getElementById("gtdi-boxerrorreporter-errors-list");elUl.innerHTML="";var errorReports=giLogger.getErrorLog(this._main.pageId);
for(var i=0;i<errorReports.length;i++)if(errorReports[i].objType&&errorReports[i].objType=="errorReport"){var elLi=doc.createElement("LI");var errorMsg=errorReports[i].errorMsg;var idx=errorMsg.indexOf("\n");if(idx>-1)errorMsg=errorMsg.substr(0,idx);elLi.innerHTML=errorMsg;elUl.appendChild(elLi)}doc.getElementById("gtdi-boxerrorreporter-email").innerHTML=account}catch(e){giLogger.error(e,"boxErrorReporter.connect",this._main?this._main.pageId:giLogger.UNKNOWN_PAGE_ID)}},disconnect:function(){this.base()},
_click:function(evt){try{var el=evt.target;if(el.id=="gtdi-boxerrorreporter-send"){var doc=this._main.gmail.canvasDocument;var email="";if(doc.getElementById("gtdi-boxerrorreporter-includeemail").checked)email=this._main.gmail.environment.getAccount();var emailHash=gihex_md5(this._main.gmail.environment.getAccount());var info=doc.getElementById("gtdi-boxerrorreporter-detail").value;var me=this;var successCallback=function(xhr){alert(giI18N.getString("Box.error.report.success"));var errorBox=me._main.getUIObject("error");
errorBox.refresh();me.disconnect()};var failCallback=function(xhr){alert(giI18N.getString("Box.error.report.fail")+" ["+xhr.status+"]")};giServerErrorReport.sendError(this._main.gmail.doc,this._main.pageId,emailHash,email,info,null,successCallback,failCallback)}this.base(evt)}catch(e){giLogger.warn(e,"boxErrorReporter._clickClose",null,this._main?this._main.pageId:giLogger.UNKNOWN_PAGE_ID)}}});
