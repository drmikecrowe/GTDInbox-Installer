var giI18NBackground=giBase.extend({_data:null,approvedLocales:["am","ar","bg","bn","ca","cs","da","de","el","en","en_GB","en_US","es","es_419","et","fi","fil","fr","gu","he","hi","hr","hu","id","it","ja","kn","ko","lt","lv","ml","mr","nb","nl","or","pl","pt","pt_BR","pt_PT","ro","ru","sk","sl","sr","sv","sw","ta","te","th","tr","uk","vi","zh","zh_CN","zh_TW"],setUserLocales:function(locales){if(!this._data)this._data={};this._data.user_locales=[];for(var i=0;i<locales.length;i++)if(this.approvedLocales.indexOf(locales[i])>
-1)this._data.user_locales.push(locales[i]);else{var splitter=locales[i].split("_");locales[i]=splitter[0];if(this.approvedLocales.indexOf(locales[i])>-1)this._data.user_locales.push(locales[i]);else;}},load:function(root){giLogger.log("st","giI18NBackground.load");if(!this._data||!this._data.user_locales)throw new Error("load cannot be called before setUserLocales");try{var manifestJson=this._readFile(root+giI18NBackground.LOCALES_DIR+"locale_manifest.json");var manifest=giJson.decode(manifestJson)}catch(e){giLogger.warn("load manifest error: "+
e,"giI18NBackground.load","json file: "+root+giI18NBackground.LOCALES_DIR+"locale_manifest.json");throw e;}this._data.default_locale=manifest.default_locale;if(this._data.user_locales.length==0)this._data.user_locales.push(this._data.default_locale);var messages={};var userLocales=this._data.user_locales.slice();userLocales.push(this._data.default_locale);for(var i=0;i<userLocales.length;i++)try{var messagesJson=this._readFile(root+giI18NBackground.LOCALES_DIR+userLocales[i]+"/messages.json")||"{}";
messages[userLocales[i]]=giJson.decode(messagesJson)}catch(e){giLogger.warn("load messages error: "+e,"giI18NBackground.load","json file: "+root+giI18NBackground.LOCALES_DIR+userLocales[i]+"/messages.json")}this._data.messages={};for(key in messages[this._data.default_locale])for(var i=0;i<userLocales.length;i++)if(messages[userLocales[i]][key]){this._data.messages[key]=messages[userLocales[i]][key].message;break}this._data.files={};for(var i=0;i<manifest.files.length;i++){var file=manifest.files[i];
var found=false;for(var j=0;j<userLocales.length;j++){var absoluteUrl=root+giI18NBackground.LOCALES_DIR+userLocales[j]+"/"+file;var fileText=this._readFile(absoluteUrl);if(fileText){this._data.files[file]=absoluteUrl;found=true;break}}if(!found)giLogger.error("Could not find file in locale: "+file,"giI18NBackground.load")}giLogger.log("fn","giI18NBackground.load")},_readFile:function(url){try{var xhr=new XMLHttpRequest;xhr.open("GET",url,false);xhr.send(null);if(xhr.status==0)return xhr.responseText}catch(e){giLogger.log(e,
"giI18NBackground._readFile")}},getData:function(){return this._data}},{LOCALES_DIR:"content/locales/"});
